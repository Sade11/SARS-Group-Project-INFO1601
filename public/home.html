<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Home</title>
	<link href="css/layout.css" rel="stylesheet" type="text/css">
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
		integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

	<script type="text/javascript" src="js/codebird.js"></script>
	<script src="https://kit.fontawesome.com/08119fe801.js" crossorigin="anonymous"></script>
</head>

<body>
	<div class="d-flex flex-column min-vh-100">
		<!--The Page Wrapper-->
		<header>
			<!--The Header of the Page -->
			<nav class="navbar navbar-light" style="background-color: #f7f5f5;">
				<div class="container">
					<a class="navbar-brand" style="color: #5198d1;" href="home.html">
						<!--When you click the logo it Will return you to the home page -->
						<img src="images/logo 2.png" width="80" height="80" alt="">
					</a>
					<form class="form-inline">
						<!--Display the Name and Log In in the Header-->
						<div>
							<input type="text" class="form-control" id="headername" readonly><span
								style="padding-left: 20px;">Is Logged In</span>

						</div>
					</form> <!-- End of Display the Name and Log In in the Header-->
				</div>
			</nav>
		</header>
		<!--End of the Header-->

		<main class="flex-fill">
			<!--The Body Wrapper-->
			<br>
			<div class="row w-100">
				<div class="col-md-3">
					<ul class="nav flex-column">
						<!--The Navigation Bar Column -->
						<li class="nav-item">
							<a class="nav-link " href="home.html"><i class="fas fa-home"></i> Home</a>
						</li>
						<li class="nav-item">
							<a class="nav-link active" href="profile.html"><i class="fas fa-user-circle"></i>
								Profile</a>
						</li>
						<li class="nav-item">
							<a class="nav-link " href="contact.html"><i class="fas fa-address-book"></i> Contact Us</a>
						</li>
						<li class="nav-item">
							<a class="nav-link active" href="privacy.html"><i class="fas fa-user-lock"></i> Privacy and
								Policy</a>
						</li>
						<li class="nav-item">
							<a class="nav-link active" href="terms.html"><i class="fas fa-file-contract"></i> Terms and
								Agreement</a>
						</li>
						<li class="nav-item">
							<a id="logout" class="nav-link" href><i class="fas fa-sign-out-alt"></i> Logout</a>
						</li>


					</ul>

				</div>
				<!--End of the Navigation Bar Column -->

				<div class="col-md-6">
					<!--The User Post Column-->
					<h2 class="h1-responsive font-weight-bold text-center my-4"> Home</h2>
					<br>
					<div class="form-group">
						<label for="newPost"></label>
						<textarea class="form-control rounded-0" id="newPost" rows="8"
							placeholder="Enter Post Here"></textarea>
					</div>
					<div class="col-sm-10">
						<button onclick="myPost()" class="btn btn-primary" type="submit">Post to Timeline</button>
					</div>
					<br>
					<br>

					<div class="post" style="padding: 20px;">

					</div>
				</div>
				<!--End of the User Post Column-->


				<div class="col-md-3">
					<!--The Embeded Tweets  Column-->
					<div>
						<a id="twtimeline" class="twitter-timeline" href=""></a>
						<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

					</div>


				</div>
				<!--End of the Embeded Tweets Column-->
			</div>
	</div>


	</main>
	<!--End for the Body Wrapper-->
	<br>
	<br>
	<section once="footers" class="index-footer bg-light" style="background-color: #f7f5f5;">
		<!--The Footer-->
		<div class="container">
			<div class="media-container-row align-center mbr-white">
				<div class="row row-links text-center">
					<p style="color: #939292;">Â© 2020, SARS</p>

				</div>
			</div>
		</div>
	</section>
	<!--End of Footer-->


	</div>
	<!--End of Page Wrapper-->
	<!-- The core Firebase JS SDK is always required and must be listed first -->
	<script src="https://www.gstatic.com/firebasejs/7.14.2/firebase-app.js"></script>
	<script src="https://www.gstatic.com/firebasejs/7.14.2/firebase-auth.js"></script>
	<script src="https://www.gstatic.com/firebasejs/7.14.2/firebase-firestore.js"></script>

	<!-- TODO: Add SDKs for Firebase products that you want to use
                https://firebase.google.com/docs/web/setup#available-libraries -->
	<script src="https://www.gstatic.com/firebasejs/7.14.2/firebase-analytics.js"></script>

	<script src="js/connection.js" type="text/javascript"></script>

	<script crossorigin src="https://unpkg.com/react@16/umd/react.production.min.js"></script>
	<script crossorigin src="https://unpkg.com/react-dom@16/umd/react-dom.production.min.js"></script>
	<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
		integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous">
		</script>
	<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
		integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous">
		</script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
		integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous">
		</script>

	<script src="js/bootstrap-notify.js"></script>
	<script>
		//*****************************logout********************************************************************************************
		const logout = document.querySelector('#logout');
		logout.addEventListener('click', (e) => {
			e.preventDefault();
			console.log("clicked");
			firebase.auth().signOut().then(function () {
				// Sign-out successful.S
				sessionStorage.clear();
				window.location.assign('index.html');
				console.log('logged out');
			}).catch(function (error) {
				// An error happened.
				console.log(error);
			});

		})

		//*****************************Set Up Post to DIsplay on the App Timeline**************************************************************************************

		const postlist = document.querySelector('.post');

		db.collection("post").orderBy('date').onSnapshot(function (querySnapshot) {
			let html = '';
			var index = 0;
			querySnapshot.forEach(function (doc) {
				const post = doc.data();
				index++;
				var card = `<div class="card">`;
				if (post.username != null) {
					card += ` <div class="card-header">${post.username}</div>`
				}
				if (post.body != null) {
					card += `<div class="card-body" id="post${index}">${post.body}</div>`
				}
				var text = post.body;
				card += ` <div class="card-footer"> 
										<div class="row">
											<div class="col-9">
												<button onclick="mytweet(${index})" class="btn btn-primary" type="submit">Share to Twitter</button>
											</div>`
				if (post.date != null) {
					card += `<div class="col-3">
												${post.date}
											</div>`
				}
				card += `</div></div>`



				card += `</div>
							<br>
							<br>
							`;

				html += card;
			});
			postlist.innerHTML = html;
		});




     //***************************** Display Your timeline and the post that was made to the app on your twitter timeline***********************************************


	</script>
	<script>
		var token;
		var secret;
		var username;


		token = sessionStorage.getItem('token');
		secret = sessionStorage.getItem('secret');
		username = sessionStorage.getItem('username');
		//console.log(username);

		document.getElementById("twtimeline").href = "https://twitter.com/" + username;

		if (username === null) {
			document.getElementById("twtimeline").href = "https://twitter.com/DreameStory?ref_src=twsrc%5Etfw";
		};


		function mytweet(index) {

			var cb = new Codebird;
			cb.setConsumerKey('YOUR API KEY', 'YOUR API SECRET KEY');
			cb.setToken(token, secret);
			var params = {
				status: document.getElementById("post" + index).innerHTML
			};
			cb.__call("statuses_update", params, function (reply, rate, err) {
				console.log(reply);
				if (reply.id != null) {
					$.notify(
						{
							// options
							title: "Success",
							message: 'Post has been shared to your Twitter timeline'
						},
						{
							// settings
							type: 'success',
							allow_dismiss: true,
							newest_on_top: false,
							offset: 20,
							spacing: 10,
							z_index: 1031,
							delay: 5000,
							timer: 1000,
							animate: {
								enter: 'animated fadeInDown',
								exit: 'animated fadeOutUp'
							},
						}
					);
				} else {
					$.notify(
						{
							// options
							title: "Error",
							message: reply.errors[0].message
						},
						{
							// settings
							type: 'danger',
							allow_dismiss: true,
							newest_on_top: false,
							offset: 20,
							spacing: 10,
							z_index: 1031,
							delay: 5000,
							timer: 1000,
							animate: {
								enter: 'animated fadeInDown',
								exit: 'animated fadeOutUp'
							},
						}
					);
				}

			});
		}
		//*************************************** Add Post to Firebase database******************************************************************************************************
		function myPost() {
			user = firebase.auth().currentUser;
			console.log(user);

			var today = new Date();
			var date = +today.getDate() + '/' + (today.getMonth() + 1) + '/' + today.getFullYear();
			db.collection("post").add({
				body: document.getElementById("newPost").value,
				username: firebase.auth().currentUser.displayName,
				date: date
			})
				.then(function () {
					console.log("Document successfully written!");
					document.getElementById('newPost').value = '';
					$.notify(
						{
							// options
							title: "Success",
							message: 'Post has been shared to your timeline'
						},
						{
							// settings
							type: 'success',
							allow_dismiss: true,
							newest_on_top: false,
							offset: 20,
							spacing: 10,
							z_index: 1031,
							delay: 5000,
							timer: 1000,
							animate: {
								enter: 'animated fadeInDown',
								exit: 'animated fadeOutUp'
							},
						}
					);
				})
				.catch(function (error) {
					console.error("Error writing document: ", error);

					$.notify(
						{
							// options
							title: "Error",
							message: "Error writing document: " + error,
						},
						{
							// settings
							type: 'danger',
							allow_dismiss: true,
							newest_on_top: false,
							offset: 20,
							spacing: 10,
							z_index: 1031,
							delay: 5000,
							timer: 1000,
							animate: {
								enter: 'animated fadeInDown',
								exit: 'animated fadeOutUp'
							},
						}
					);
				});
		}

		//********************************Display Name in the Header*******************************************************************************************************************

		document.addEventListener("DOMContentLoaded", function () {
			var displayName = sessionStorage.getItem('displayName');
			console.log();
			document.getElementById('headername').value = displayName;


		});
		//****************************************************************************************************************************************************************

	</script>


</body>

</html>
